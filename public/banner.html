<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cookie Banner</title>
</head>
<body style="margin:0;padding:40px 20px;font-family:system-ui;background:#f5f5f5;min-height:100vh">

<div style="text-align:center;max-width:800px;margin:0 auto">
    <h1 style="color:#7c3aed;font-size:2rem;margin-bottom:1rem">Cookie Banner Test</h1>
    <p style="color:#666;margin-bottom:2rem">Komplett neu aufgebaut</p>
    <button onclick="testBanner()" style="background:#7c3aed;color:white;border:none;padding:12px 24px;border-radius:6px;cursor:pointer">
        Banner testen
    </button>
</div>

<!-- Cookie Banner -->
<div id="cookieBanner" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:99999;display:none;align-items:center;justify-content:center;padding:20px">
    <div style="background:white;border-radius:12px;padding:30px;max-width:420px;width:100%;box-shadow:0 10px 30px rgba(0,0,0,0.15);text-align:center">
        <h3 style="margin:0 0 8px 0;font-size:20px;color:#333">üç™ Cookies</h3>
        <p style="margin:0 0 20px 0;font-size:14px;color:#666;line-height:1.5">
            Wir nutzen Cookies f√ºr Grundfunktionen und - mit deiner Zustimmung - f√ºr Statistiken. 
            <a href="/datenschutz.html" style="color:#7c3aed;text-decoration:none">Mehr erfahren</a>
        </p>
        <div style="display:flex;flex-direction:column;gap:8px">
            <button onclick="cookieAcceptAll()" style="background:#22c55e;color:white;border:none;padding:12px 16px;border-radius:6px;cursor:pointer;font-weight:500;font-size:14px;width:100%">
                Alle akzeptieren
            </button>
            <button onclick="cookieShowSettings()" style="background:white;color:#7c3aed;border:1px solid #7c3aed;padding:12px 16px;border-radius:6px;cursor:pointer;font-size:14px;width:100%">
                Einstellungen
            </button>
            <button onclick="cookieRejectAll()" style="background:#f3f4f6;color:#666;border:none;padding:12px 16px;border-radius:6px;cursor:pointer;font-size:14px;width:100%">
                Nur notwendige
            </button>
        </div>
    </div>
</div>

<!-- Settings Modal -->
<div id="settingsModal" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:100000;display:none;align-items:center;justify-content:center;padding:20px">
    <div style="background:white;border-radius:12px;padding:24px;max-width:450px;width:100%;max-height:80vh;overflow-y:auto">
        <h3 style="margin:0 0 16px 0;font-size:18px;color:#333;text-align:center">Cookie-Einstellungen</h3>
        
        <div style="margin:8px 0;padding:12px;background:#f9f9f9;border-radius:6px;display:flex;align-items:center">
            <input type="checkbox" checked disabled style="margin-right:10px"> 
            <div>
                <strong>Notwendig</strong> (immer aktiv)<br>
                <small style="color:#666;font-size:12px">F√ºr Grundfunktionen erforderlich</small>
            </div>
        </div>
        
        <div style="margin:8px 0;padding:12px;background:#f9f9f9;border-radius:6px;display:flex;align-items:center">
            <input id="statsCheckbox" type="checkbox" style="margin-right:10px;accent-color:#7c3aed"> 
            <div>
                <strong>Statistik</strong><br>
                <small style="color:#666;font-size:12px">Zur Verbesserung der Website</small>
            </div>
        </div>
        
        <div style="margin:8px 0;padding:12px;background:#f9f9f9;border-radius:6px;display:flex;align-items:center">
            <input id="marketingCheckbox" type="checkbox" style="margin-right:10px;accent-color:#7c3aed"> 
            <div>
                <strong>Marketing</strong><br>
                <small style="color:#666;font-size:12px">F√ºr personalisierte Werbung</small>
            </div>
        </div>
        
        <div style="display:flex;gap:8px;margin-top:16px">
            <button onclick="settingsCancel()" style="background:#f3f4f6;color:#666;border:none;padding:10px 14px;border-radius:6px;cursor:pointer;flex:1;font-size:14px">
                Abbrechen
            </button>
            <button onclick="settingsSave()" style="background:#7c3aed;color:white;border:none;padding:10px 14px;border-radius:6px;cursor:pointer;flex:1;font-size:14px">
                Speichern
            </button>
        </div>
    </div>
</div>

<script>
const COOKIE_KEY = 'cookie_consent_v1';

// Hilfsfunktionen
function getCookieConsent() {
    try {
        return JSON.parse(localStorage.getItem(COOKIE_KEY) || '{}');
    } catch(e) {
        return {};
    }
}

function setCookieConsent(consent) {
    localStorage.setItem(COOKIE_KEY, JSON.stringify({
        ...consent,
        timestamp: Date.now()
    }));
    console.log('Cookie-Consent gespeichert:', consent);
}

function hasCookieDecision() {
    const consent = getCookieConsent();
    return consent.hasOwnProperty('necessary');
}

// Banner-Funktionen
function showCookieBanner() {
    console.log('Banner anzeigen');
    document.getElementById('cookieBanner').style.display = 'flex';
}

function hideCookieBanner() {
    console.log('Banner verstecken');
    document.getElementById('cookieBanner').style.display = 'none';
}

// Button-Funktionen
function cookieAcceptAll() {
    console.log('Alle Cookies akzeptiert!');
    setCookieConsent({
        necessary: true,
        statistics: true,
        marketing: true
    });
    hideCookieBanner();
}

function cookieRejectAll() {
    console.log('Nur notwendige Cookies akzeptiert!');
    setCookieConsent({
        necessary: true,
        statistics: false,
        marketing: false
    });
    hideCookieBanner();
}

function cookieShowSettings() {
    console.log('Einstellungen anzeigen');
    // Vorherige Werte laden
    const consent = getCookieConsent();
    document.getElementById('statsCheckbox').checked = consent.statistics || false;
    document.getElementById('marketingCheckbox').checked = consent.marketing || false;
    
    document.getElementById('settingsModal').style.display = 'flex';
}

// Settings-Funktionen
function settingsCancel() {
    console.log('Einstellungen abbrechen');
    document.getElementById('settingsModal').style.display = 'none';
}

function settingsSave() {
    console.log('Einstellungen speichern');
    const stats = document.getElementById('statsCheckbox').checked;
    const marketing = document.getElementById('marketingCheckbox').checked;
    
    setCookieConsent({
        necessary: true,
        statistics: stats,
        marketing: marketing
    });
    
    document.getElementById('settingsModal').style.display = 'none';
    hideCookieBanner();
}

// Test-Funktion
function testBanner() {
    console.log('Test-Banner');
    showCookieBanner();
}

// Modal schlie√üen bei Klick au√üerhalb
document.addEventListener('click', function(e) {
    const banner = document.getElementById('cookieBanner');
    const modal = document.getElementById('settingsModal');
    
    if (e.target === banner) {
        hideCookieBanner();
    }
    if (e.target === modal) {
        settingsCancel();
    }
});

// Beim Laden der Seite pr√ºfen
document.addEventListener('DOMContentLoaded', function() {
    console.log('Seite geladen - pr√ºfe Cookie-Consent...');
    if (!hasCookieDecision()) {
        console.log('Keine Cookie-Entscheidung gefunden - Banner anzeigen');
        showCookieBanner();
    } else {
        console.log('Cookie-Entscheidung gefunden - Banner verstecken');
        hideCookieBanner();
    }
});

// Globale Funktion f√ºr sp√§teres √ñffnen
window.openCookieSettings = function() {
    showCookieBanner();
    cookieShowSettings();
};
</script>

</body>
</html>