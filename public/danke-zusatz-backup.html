<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danke! | Pfoten-Plan</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" href="/favconHund.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #FAF8F5;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            max-width: 420px;
            text-align: center;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #22C55E, #16A34A);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            box-shadow: 0 10px 30px rgba(34, 197, 94, 0.3);
            animation: pop 0.5s ease;
        }

        @keyframes pop {
            0% { transform: scale(0); }
            70% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .success-icon svg {
            width: 40px;
            height: 40px;
            color: white;
        }

        h1 {
            font-size: 26px;
            color: #1a1a1a;
            margin-bottom: 12px;
        }

        .dog-name {
            color: #C4A576;
        }

        .subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .order-box {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            text-align: left;
            margin-bottom: 24px;
        }

        .order-title {
            font-size: 14px;
            color: #999;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .order-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .order-icon {
            width: 44px;
            height: 44px;
            background: #FEF3E7;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }

        .order-info h3 {
            font-size: 15px;
            color: #1a1a1a;
            margin-bottom: 2px;
        }

        .order-info p {
            font-size: 13px;
            color: #666;
        }

        .order-check {
            margin-left: auto;
            color: #22C55E;
            font-size: 20px;
        }

        .email-note {
            font-size: 14px;
            color: #666;
            background: #F8F8F8;
            padding: 16px;
            border-radius: 10px;
            line-height: 1.6;
        }

        .email-note strong {
            color: #1a1a1a;
        }

        .support-note {
            font-size: 13px;
            color: #999;
            text-align: center;
            margin-top: 16px;
        }

        .support-note a {
            color: #C4A576;
            text-decoration: none;
        }

        .support-note a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="success-icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
            </svg>
        </div>

        <h1>Perfekt, <span class="dog-name">Luna</span>!</h1>
        <p class="subtitle">Dein erweitertes Training ist jetzt komplett.</p>

        <div class="order-box">
            <div class="order-title">Deine Bestellung</div>
            
            <div class="order-item" id="mainPlan">
                <div class="order-icon">üìã</div>
                <div class="order-info">
                    <h3>Trainingsplan</h3>
                    <p>Hauptproblem</p>
                </div>
                <span class="order-check">‚úì</span>
            </div>

            <div class="order-item" id="upsellModule">
                <div class="order-icon" id="moduleIcon">üò∞</div>
                <div class="order-info">
                    <h3 id="moduleName">Zusatz-Modul</h3>
                    <p>8 √úbungen ‚Ä¢ 2 Wochen</p>
                </div>
                <span class="order-check">‚úì</span>
            </div>
        </div>

        <div class="email-note">
            üìß <strong>Beide Pl√§ne</strong> werden in wenigen Minuten an deine E-Mail gesendet.
        </div>

        <div class="support-note">
            Fragen? Schreib uns an <a href="/cdn-cgi/l/email-protection#6615131616091412260b030f084b1107131103140d480203"><span class="__cf_email__" data-cfemail="e99a9c9999869b9da9848c8087c49e889c9e8c9b82c78d8c">[email&#160;protected]</span></a>
        </div>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // Supabase Config
        const SUPABASE_URL = 'https://xomsibpyksrzrnixbdwf.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhvbXNpYnB5a3NyenJuaXhiZHdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkzOTc2MDcsImV4cCI6MjA2NDk3MzYwN30.xvXSBo_8Xfb0GbmQKYHUOjd3cakOdeoFl2ZzFdNjtpc';

        // Hundename aus localStorage
        const dogName = localStorage.getItem('dogName') || 'dein Hund';
        document.querySelector('.dog-name').textContent = dogName;

        // Parameter aus URL
        const urlParams = new URLSearchParams(window.location.search);
        const module = urlParams.get('module');
        const leadId = urlParams.get('lead_id') || localStorage.getItem('leadId');

        const moduleData = {
            'anxiety': { icon: 'üò∞', name: 'Trennungsangst Pr√§vention' },
            'pulling': { icon: 'ü¶Æ', name: 'Leinenf√ºhrigkeit Basics' },
            'barking': { icon: 'üîä', name: 'Anti-Bell Training' },
            'aggression': { icon: 'üò§', name: 'Aggressions-Kontrolle' },
            'recall': { icon: 'üì£', name: 'R√ºckruf-Training' },
            'jumping': { icon: 'üêï', name: 'Anti-Anspring Training' }
        };

        // Helper f√ºr JSON parsing
        function parseJSON(str) {
            try { return JSON.parse(str); } 
            catch { return null; }
        }

        if (module && moduleData[module]) {
            document.getElementById('moduleIcon').textContent = moduleData[module].icon;
            document.getElementById('moduleName').textContent = moduleData[module].name;
            
            // Upsell-Modul in Supabase speichern
            if (leadId) {
                console.log('üîç Lead ID gefunden:', leadId);

                fetch(`${SUPABASE_URL}/rest/v1/wauwerk_leads?id=eq.${leadId}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    },
                    body: JSON.stringify({
                        upsell_module: module
                    })
                }).then(response => {
                    console.log('üì° Supabase Response Status:', response.status);
                    if (response.ok) {
                        console.log('‚úÖ Upsell-Modul gespeichert:', module);
                    } else {
                        response.text().then(text => console.error('‚ùå Supabase Fehler:', text));
                    }
                }).catch(err => {
                    console.error('‚ùå Supabase update error:', err);
                });
            } else {
                console.warn('‚ö†Ô∏è Keine lead_id gefunden! URL:', window.location.href);
                console.log('localStorage leadId:', localStorage.getItem('leadId'));
            }
        }

        // Hauptproblem aus localStorage
        const mainProblem = localStorage.getItem('dogProblem');
        const problemNames = {
            'pulling': 'Leinenziehen',
            'barking': 'Bellen',
            'anxiety': 'Trennungsangst',
            'aggression': 'Aggression',
            'recall': 'R√ºckruf',
            'jumping': 'Anspringen',
            'energy': '√úberm√§√üige Energie',
            'destructive': 'Zerst√∂rerisches Verhalten',
            'disobedience': 'Ungehorsam',
            'mouthing': 'Unerw√ºnschtes Aufnehmen'
        };

        if (mainProblem && problemNames[mainProblem]) {
            document.getElementById('mainProblemName').textContent = problemNames[mainProblem] + '-Training';
        }
    </script>
</body>
</html>