<!DOCTYPE html>
<html lang="de">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=AW-17806525009"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'AW-17806525009');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WauWerk - Dein Trainingsplan ist fertig</title>
    <link rel="icon" type="image/png" href="favconHund.png">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --text-dark: #2C2C2E; --text-medium: #6B6B6B; --text-light: #999999;
            --background: #FFFFFF; --white: #FFFFFF; --border-light: #E8E4DF;
            --light-brown: #D4B996; --warm-brown: #C4A576; --dark-brown: #8B7355;
            --accent-red: #E8A598; --accent-green: #A8C5A0; --border-radius: 12px;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--background); color: var(--text-dark); line-height: 1.5; }
        .header { background: var(--white); padding: 16px 20px; text-align: center; border-bottom: 1px solid var(--border-light); }
        .logo { display: inline-flex; align-items: center; gap: 10px; text-decoration: none; }
        .logo-image { width: 36px; height: 36px; border-radius: 8px; }
        .logo-text { font-size: 24px; font-weight: 800; color: var(--text-dark); }
        .timer-bar { background: var(--dark-brown); color: var(--white); padding: 12px 20px; text-align: center; font-size: 16px; }
        .timer-bar span { font-weight: 700; color: #F5E6D3; }
        .timer-bar.code-active { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .hero-section { background: linear-gradient(180deg, #F5EDE3 0%, #FFFFFF 100%); padding: 30px 20px 40px; }
        .comparison-container { max-width: 600px; margin: 0 auto; display: flex; gap: 15px; position: relative; }
        .comparison-side { flex: 1; text-align: center; }
        .comparison-badge { display: inline-block; padding: 6px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; margin-bottom: 15px; }
        .badge-now { background: var(--white); color: var(--text-dark); border: 1px solid var(--border-light); }
        .badge-goal { background: var(--warm-brown); color: var(--white); }
        .comparison-image { width: 100%; height: 320px; background: var(--border-light); border-radius: var(--border-radius); margin-bottom: 20px; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
        .image-now { background: linear-gradient(135deg, #F0DED0 0%, #F5E8DD 100%); }
        .image-goal { background: linear-gradient(135deg, #E8DCCC 0%, #F0E6DA 100%); }
        .comparison-arrows { position: absolute; left: 50%; top: 45%; transform: translate(-50%, -50%); display: flex; flex-direction: column; align-items: center; gap: 2px; font-size: 26px; z-index: 10; }
        .comparison-arrows span { color: var(--warm-brown); opacity: 0.4; animation: lightUp 2s ease-in-out infinite; }
        .comparison-arrows span:nth-child(1) { animation-delay: 0s; }
        .comparison-arrows span:nth-child(2) { animation-delay: 0.15s; }
        .comparison-arrows span:nth-child(3) { animation-delay: 0.3s; }
        .comparison-arrows span:nth-child(4) { animation-delay: 0.45s; }
        .comparison-arrows span:nth-child(5) { animation-delay: 0.6s; }
        .comparison-arrows span:nth-child(6) { animation-delay: 0.75s; }
        @keyframes lightUp { 0%, 100% { opacity: 0.4; text-shadow: none; } 50% { opacity: 1; text-shadow: 0 0 15px rgba(196, 165, 118, 0.9), 0 0 25px rgba(196, 165, 118, 0.6); } }
        .stat-box { background: var(--white); border-radius: var(--border-radius); padding: 15px; margin-bottom: 10px; }
        .stat-label { font-size: 13px; font-weight: 600; color: var(--text-dark); margin-bottom: 4px; }
        .stat-value { font-size: 14px; color: var(--text-medium); }
        .stat-bar { display: flex; gap: 6px; margin-top: 8px; padding: 4px; border: 1px solid var(--border-light); border-radius: 6px; background: var(--white); }
        .stat-bar-segment { flex: 1; height: 6px; border-radius: 3px; background: var(--border-light); }
        .stat-bar-segment.active-red { background: var(--accent-red); }
        .stat-bar-segment.active-green { background: #4CAF50; }
        .container { max-width: 600px; margin: 0 auto; padding: 30px 20px; }
        .title-section { text-align: center; margin-bottom: 30px; }
        .main-title { font-size: 28px; font-weight: 800; color: var(--text-dark); margin-bottom: 20px; line-height: 1.2; }
        .goal-badges { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
        .goal-badge { display: flex; align-items: center; gap: 10px; background: var(--white); padding: 12px 18px; border-radius: var(--border-radius); border: 1px solid var(--border-light); }
        .goal-badge-icon { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .icon-blue { background: #F5EDE3; color: var(--dark-brown); }
        .icon-orange { background: #F5E6D8; color: var(--warm-brown); }
        .goal-badge-text { text-align: left; }
        .goal-badge-label { font-size: 11px; color: var(--text-light); text-transform: uppercase; }
        .goal-badge-value { font-size: 14px; font-weight: 600; color: var(--text-dark); }
        .motivation-text { text-align: center; margin-bottom: 25px; padding: 20px; background: linear-gradient(135deg, #FAF6F1 0%, var(--white) 100%); border-radius: var(--border-radius); border: 1px solid var(--border-light); }
        .motivation-text p { font-size: 16px; color: var(--text-medium); line-height: 1.6; margin-bottom: 10px; }
        .motivation-text .problem-highlight { color: var(--warm-brown); font-weight: 600; }
        .motivation-question { font-size: 18px !important; font-weight: 600 !important; color: var(--text-dark) !important; margin-bottom: 0 !important; }
        .pricing-section { margin-bottom: 30px; }
        .pricing-card { background: var(--white); border: 2px solid var(--border-light); border-radius: var(--border-radius); padding: 20px; margin-bottom: 12px; cursor: pointer; transition: all 0.2s ease; position: relative; }
        .pricing-card:hover { border-color: var(--light-brown); }
        .pricing-card.selected { border-color: var(--light-brown); background: linear-gradient(135deg, #FAF6F1 0%, var(--white) 100%); }
        .pricing-card.popular { padding-top: 35px; }
        .popular-badge { position: absolute; top: 0; left: 0; right: 0; background: var(--warm-brown); color: var(--white); text-align: center; padding: 8px; font-size: 12px; font-weight: 700; text-transform: uppercase; border-radius: var(--border-radius) var(--border-radius) 0 0; }
        .pricing-header { display: flex; flex-direction: column; align-items: center; gap: 15px; text-align: center; }
        .pricing-left { display: flex; align-items: center; gap: 12px; justify-content: center; }
        .pricing-radio { width: 22px; height: 22px; border: 2px solid var(--border-light); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .pricing-card.selected .pricing-radio { border-color: var(--warm-brown); background: var(--warm-brown); }
        .pricing-card.selected .pricing-radio::after { content: ''; width: 8px; height: 8px; background: var(--white); border-radius: 50%; }
        .pricing-name { font-size: 16px; font-weight: 600; color: var(--text-dark); }
        .pricing-right { text-align: center; }
        .pricing-price { display: flex; align-items: baseline; gap: 6px; justify-content: center; }
        .price-currency { font-size: 14px; font-weight: 600; color: var(--text-dark); }
        .price-amount { font-size: 32px; font-weight: 800; color: var(--text-dark); line-height: 1; }
        .price-cents { font-size: 16px; font-weight: 700; color: var(--text-dark); }
        .price-period { font-size: 12px; color: var(--text-light); }
        .price-old { font-size: 14px; color: var(--accent-red); text-decoration: line-through; }
        .cta-button { width: 100%; background: var(--warm-brown); color: var(--white); border: none; border-radius: var(--border-radius); padding: 20px; font-size: 18px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 15px; line-height: 1.1; }
        .cta-button:hover { background: var(--dark-brown); transform: translateY(-2px); box-shadow: 0 8px 25px rgba(139, 115, 85, 0.4); }
        .cta-button.glow { animation: glow 2s ease-in-out infinite; }
        @keyframes glow { 0%, 100% { box-shadow: 0 0 5px rgba(196, 165, 118, 0.4), 0 0 15px rgba(196, 165, 118, 0.2); } 50% { box-shadow: 0 0 20px rgba(196, 165, 118, 0.6), 0 0 40px rgba(196, 165, 118, 0.4); } }
        .disclaimer { background: #F9F7F5; border-radius: var(--border-radius); padding: 15px 20px; margin-bottom: 20px; font-size: 13px; color: var(--text-medium); line-height: 1.6; text-align: center; }
        .disclaimer a { color: var(--warm-brown); text-decoration: none; font-weight: 600; }
        .guarantee { display: flex; align-items: center; justify-content: center; gap: 8px; color: var(--text-medium); font-size: 14px; margin-bottom: 30px; }
        .guarantee svg { width: 20px; height: 20px; fill: var(--warm-brown); }
        .payment-logos { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
        .payment-logos img { height: 28px; width: auto; opacity: 0.7; border-radius: 6px; }
        .section-header { text-align: center; margin-bottom: 25px; }
        .section-title { font-size: 20px; font-weight: 700; color: var(--text-dark); margin-bottom: 5px; }
        .section-subtitle { font-size: 14px; color: var(--warm-brown); }
        .testimonial-card { background: var(--white); border-radius: var(--border-radius); padding: 20px; margin-bottom: 15px; border: 1px solid var(--border-light); }
        .testimonial-image-single { width: 100%; height: auto; aspect-ratio: 1875 / 1563; background: var(--border-light); border-radius: 8px; margin-bottom: 15px; overflow: hidden; }
        .testimonial-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .testimonial-name { font-weight: 700; color: var(--text-dark); }
        .testimonial-problem { font-size: 13px; color: var(--text-light); }
        .testimonial-problem span { color: var(--warm-brown); font-weight: 600; }
        .testimonial-text { font-size: 14px; color: var(--text-medium); line-height: 1.6; }
        .benefits-box { background: var(--white); border-radius: var(--border-radius); padding: 25px; margin-bottom: 25px; border: 1px solid var(--border-light); }
        .benefits-title { font-size: 20px; font-weight: 700; color: var(--text-dark); margin-bottom: 20px; text-align: center; }
        .benefits-list { list-style: none; padding: 0; margin: 0; }
        .benefits-list li { padding: 10px 0; font-size: 15px; color: var(--text-dark); border-bottom: 1px solid var(--border-light); }
        .benefits-list li:last-child { border-bottom: none; }
        .trustpilot-slider { margin-bottom: 30px; overflow: hidden; }
        .trustpilot-track { display: flex; transition: transform 0.4s ease; }
        .trustpilot-review { min-width: 100%; text-align: center; padding: 20px; background: var(--white); border-radius: var(--border-radius); border: 1px solid var(--border-light); }
        .trustpilot-stars { display: flex; gap: 2px; margin-bottom: 12px; justify-content: center; }
        .tp-star { width: 22px; height: 22px; background: #00B67A; color: white; font-size: 14px; display: flex; align-items: center; justify-content: center; }
        .trustpilot-text { font-size: 15px; color: var(--text-dark); margin-bottom: 10px; font-style: italic; }
        .trustpilot-name { font-size: 13px; color: var(--text-medium); font-weight: 600; }
        .trustpilot-dots { display: flex; justify-content: center; gap: 8px; margin-top: 15px; }
        .tp-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--border-light); cursor: pointer; }
        .tp-dot.active { background: var(--warm-brown); }
        .guarantee-box { background: var(--white); border: 2px solid var(--light-brown); border-radius: var(--border-radius); padding: 25px; text-align: center; margin-bottom: 30px; }
        .guarantee-title { font-size: 20px; font-weight: 700; color: var(--text-dark); margin-bottom: 12px; }
        .guarantee-text { font-size: 14px; color: var(--text-medium); line-height: 1.6; margin-bottom: 15px; }
        .guarantee-badge { display: inline-flex; align-items: center; gap: 8px; color: var(--warm-brown); }
        .guarantee-badge svg { width: 40px; height: 40px; fill: var(--warm-brown); }
        .faq-section { background: var(--white); border-radius: var(--border-radius); padding: 25px; margin-bottom: 30px; }
        .faq-title { font-size: 20px; font-weight: 700; color: var(--text-dark); text-align: center; margin-bottom: 20px; }
        .faq-item { margin-bottom: 20px; }
        .faq-item:last-child { margin-bottom: 0; }
        .faq-question { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 8px; }
        .faq-icon { width: 24px; height: 24px; background: var(--warm-brown); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .faq-icon svg { width: 14px; height: 14px; fill: var(--white); }
        .faq-question-text { font-size: 15px; font-weight: 600; color: var(--text-dark); }
        .faq-answer { font-size: 14px; color: var(--text-medium); line-height: 1.6; padding-left: 36px; }
        .footer { text-align: center; padding: 20px; color: var(--text-light); font-size: 12px; }
        .footer a { color: var(--text-light); text-decoration: underline; }
        .exit-popup-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); z-index: 9999; align-items: center; justify-content: center; padding: 20px; }
        .exit-popup-overlay.active { display: flex; }
        .exit-popup { background: var(--white); border-radius: 16px; max-width: 400px; width: 100%; padding: 30px 25px; text-align: center; position: relative; animation: popupIn 0.3s ease-out; }
        @keyframes popupIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .exit-popup-close { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; color: var(--text-light); cursor: pointer; }
        .exit-popup-emoji { font-size: 50px; margin-bottom: 15px; }
        .exit-popup-title { font-size: 22px; font-weight: 700; color: var(--text-dark); margin-bottom: 12px; }
        .exit-popup-text { font-size: 15px; color: var(--text-medium); margin-bottom: 20px; line-height: 1.5; }
        .exit-popup-highlight { color: var(--warm-brown); font-weight: 600; }
        .exit-popup-bonus { background: linear-gradient(135deg, #FFF9F0 0%, #FFF5E6 100%); border: 1px solid var(--border-light); border-radius: 10px; padding: 15px; margin-bottom: 20px; }
        .exit-popup-bonus-title { font-size: 14px; font-weight: 600; color: var(--dark-brown); margin-bottom: 8px; }
        .exit-popup-bonus-list { font-size: 13px; color: var(--text-medium); text-align: left; }
        .exit-popup-bonus-list div { padding: 4px 0; }
        .exit-popup-cta { background: var(--warm-brown); color: white; border: none; border-radius: 10px; padding: 14px 24px; font-size: 16px; font-weight: 600; cursor: pointer; width: 100%; margin-bottom: 12px; }
        .exit-popup-cta:hover { background: var(--dark-brown); }
        .exit-popup-skip { background: none; border: none; color: var(--text-light); font-size: 13px; cursor: pointer; text-decoration: underline; }
        .checkout-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(44, 44, 46, 0.85); z-index: 10000; justify-content: center; align-items: center; backdrop-filter: blur(8px); overflow: hidden; touch-action: none; }
        .checkout-overlay.active { display: flex; }
        .checkout-popup { background: var(--white); border-radius: 20px; max-width: 420px; width: calc(100% - 40px); max-height: 70%; overflow-y: auto; position: relative; animation: popupIn 0.3s ease-out; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25); margin-top: 60px; }
        .checkout-header { padding: 14px 16px 10px; border-bottom: 1px solid var(--border-light); position: relative; background: linear-gradient(180deg, #FAF7F4 0%, var(--white) 100%); border-radius: 20px 20px 0 0; }
        .checkout-close { position: absolute; top: 14px; left: 14px; background: var(--white); border: 1px solid var(--border-light); width: 32px; height: 32px; border-radius: 50%; font-size: 18px; color: var(--text-medium); cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .checkout-title { text-align: center; font-size: 18px; font-weight: 700; color: var(--text-dark); }
        .checkout-title span { color: var(--warm-brown); }
        .checkout-body { padding: 12px 16px 16px; }
        .checkout-plan-card { display: flex; align-items: center; gap: 10px; padding: 10px; background: linear-gradient(135deg, #FAF7F4 0%, #F5F0EB 100%); border-radius: 10px; margin-bottom: 12px; border: 1px solid var(--border-light); }
        .checkout-plan-image { width: 42px; height: 42px; background: linear-gradient(135deg, var(--warm-brown), var(--dark-brown)); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
        .checkout-plan-info { flex: 1; }
        .checkout-plan-name { font-size: 14px; font-weight: 700; color: var(--text-dark); margin-bottom: 2px; }
        .checkout-plan-duration { font-size: 13px; color: var(--warm-brown); font-weight: 500; }
        .checkout-plan-price-box { text-align: right; }
        .checkout-plan-price { font-size: 20px; font-weight: 800; color: var(--text-dark); }
        .checkout-plan-access { font-size: 11px; color: var(--text-light); font-weight: 500; }
        .checkout-step-email { text-align: center; }
        .checkout-step-email.hidden { display: none; }
        .checkout-email-icon { font-size: 48px; margin-bottom: 15px; }
        .checkout-email-title { font-size: 18px; font-weight: 700; color: var(--text-dark); margin-bottom: 8px; }
        .checkout-email-subtitle { font-size: 14px; color: var(--text-medium); margin-bottom: 20px; }
        .checkout-email-input { width: 100%; padding: 14px 16px; border: 2px solid var(--border-light); border-radius: 10px; font-size: 16px; margin-bottom: 12px; }
        .checkout-email-input:focus { outline: none; border-color: var(--warm-brown); }
        .checkout-email-btn { width: 100%; padding: 14px; background: linear-gradient(135deg, var(--warm-brown), var(--dark-brown)); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 700; cursor: pointer; margin-bottom: 15px; }
        .checkout-email-privacy { font-size: 11px; color: var(--text-light); }
        .checkout-trust-badge { display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 16px; padding: 10px; background: #f8f8f8; border-radius: 8px; }
        .trust-stars { display: flex; gap: 2px; }
        .trust-star { width: 20px; height: 20px; background: #00b67a; display: flex; align-items: center; justify-content: center; }
        .trust-star svg { width: 12px; height: 12px; fill: white; }
        .trust-text { font-size: 12px; color: var(--text-dark); font-weight: 500; }
        .trust-text strong { color: #00b67a; }
        .checkout-features-compact { background: #f8f8f8; border-radius: 8px; padding: 8px 10px; margin-bottom: 10px; }
        .checkout-feature-row { font-size: 12px; color: var(--text-dark); padding: 3px 0; }
        .checkout-feature-row span { color: var(--warm-brown); font-weight: 600; }
        .checkout-total-compact { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-top: 2px solid var(--warm-brown); margin-bottom: 8px; }
        .checkout-total-compact .checkout-total-label { font-size: 13px; font-weight: 700; color: var(--text-dark); }
        .checkout-total-compact .checkout-total-saved { font-size: 10px; color: #e74c3c; font-weight: 600; display: block; }
        .checkout-total-compact .checkout-total-price { font-size: 20px; font-weight: 800; color: var(--warm-brown); }
        .checkout-guarantee-compact { text-align: center; font-size: 11px; color: #166534; font-weight: 600; padding: 6px; background: #f0fdf4; border-radius: 6px; margin-bottom: 10px; }
        .checkout-continue-btn { width: 100%; padding: 12px; background: linear-gradient(135deg, var(--warm-brown), var(--dark-brown)); color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 700; cursor: pointer; text-transform: uppercase; letter-spacing: 0.5px; box-shadow: 0 4px 15px rgba(196, 165, 118, 0.4); }
        .checkout-step-2 { display: none; }
        .checkout-step-2.active { display: block; }
        .checkout-step-1.hidden { display: none; }
        .checkout-summary { background: linear-gradient(135deg, #FAF7F4 0%, #F5F0EB 100%); border-radius: 14px; padding: 18px; margin-bottom: 20px; border: 1px solid var(--border-light); }
        .checkout-summary-row { display: flex; justify-content: space-between; padding: 8px 0; font-size: 15px; color: var(--text-dark); }
        .checkout-summary-row.total { border-top: 2px solid var(--warm-brown); margin-top: 10px; padding-top: 14px; font-weight: 700; font-size: 18px; }
        .checkout-summary-old { text-decoration: line-through; color: var(--text-light); margin-right: 10px; }
        .checkout-summary-saved { color: #27ae60; font-size: 13px; text-align: right; font-weight: 700; margin-top: 5px; }
        .stripe-element-container { padding: 18px; border: 2px solid var(--border-light); border-radius: 14px; margin-bottom: 18px; background: var(--white); }
        #payment-element { min-height: 100px; }
        .checkout-pay-btn { width: 100%; padding: 16px; background: linear-gradient(135deg, var(--warm-brown), var(--dark-brown)); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 4px 15px rgba(196, 165, 118, 0.4); }
        .checkout-pay-btn:disabled { background: #ccc; cursor: not-allowed; }
        .checkout-pay-btn .spinner { width: 20px; height: 20px; border: 2px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .payment-icons { display: flex; justify-content: center; align-items: center; gap: 12px; margin-top: 20px; padding: 12px; background: #FAFAFA; border-radius: 10px; }
        .payment-icons img { height: 20px; opacity: 0.7; }
        .checkout-back { display: block; width: 100%; background: none; border: none; color: var(--text-medium); font-size: 14px; cursor: pointer; margin-top: 18px; text-align: center; }
        .checkout-error { background: #FEF2F2; color: #DC2626; padding: 14px 16px; border-radius: 10px; margin-bottom: 18px; font-size: 14px; display: none; border: 1px solid #FECACA; }
        .checkout-error.visible { display: block; }
        @media (max-width: 480px) {
            .comparison-container { flex-direction: row; gap: 10px; }
            .comparison-image { height: 200px; }
            .comparison-arrows { display: none; }
            .main-title { font-size: 24px; }
            .goal-badges { flex-direction: column; align-items: center; }
        }
    </style>
    <script>
    !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');
    fbq('init','864109602683515');fbq('track','PageView');
    </script>
    <script>(function(c,l,a,r,i,t,y){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);})(window,document,"clarity","script","ufxcf43805");</script>
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <header class="header"><div class="logo"><img src="logo.png" alt="WauWerk Logo" class="logo-image"><span class="logo-text">Mein WauWerk</span></div></header>
    <div class="timer-bar" id="timerBar">Preis reduziert f√ºr: <span id="timer">10:00</span></div>
    <section class="hero-section">
        <div class="comparison-container">
            <div class="comparison-side">
                <span class="comparison-badge badge-now">Jetzt</span>
                <div class="comparison-image image-now"><img src="Vorher.png" alt="Vorher" style="width:100%;height:100%;object-fit:cover;"></div>
                <div class="stat-box"><div class="stat-label"><span id="dogName1">Dein Hund</span> ‚Äì <span id="problemLabel1">Gehorsam</span></div><div class="stat-value" id="problemValue1">Niedrig</div><div class="stat-bar"><div class="stat-bar-segment active-red"></div><div class="stat-bar-segment"></div><div class="stat-bar-segment"></div></div></div>
                <div class="stat-box"><div class="stat-label">Trainingslevel</div><div class="stat-value">Anf√§nger</div></div>
            </div>
            <div class="comparison-arrows"><span>‚Ä∫‚Ä∫</span><span>‚Ä∫‚Ä∫</span><span>‚Ä∫‚Ä∫</span><span>‚Ä∫‚Ä∫</span><span>‚Ä∫‚Ä∫</span><span>‚Ä∫‚Ä∫</span></div>
            <div class="comparison-side">
                <span class="comparison-badge badge-goal">Dein Ziel</span>
                <div class="comparison-image image-goal"><img src="Nachher.png" alt="Nachher" style="width:100%;height:100%;object-fit:cover;"></div>
                <div class="stat-box"><div class="stat-label"><span id="dogName2">Dein Hund</span> ‚Äì <span id="problemLabel2">Gehorsam</span></div><div class="stat-value" id="problemValue2">Normal</div><div class="stat-bar"><div class="stat-bar-segment active-green"></div><div class="stat-bar-segment active-green"></div><div class="stat-bar-segment active-green"></div></div></div>
                <div class="stat-box"><div class="stat-label">Trainingslevel</div><div class="stat-value">Fortgeschritten</div></div>
            </div>
        </div>
    </section>
    <div class="container">
        <div class="title-section">
            <h1 class="main-title">Dein personalisierter Trainingsplan f√ºr <span id="dogName3">deinen Hund</span> ist fertig!</h1>
            <div class="goal-badges">
                <div class="goal-badge"><div class="goal-badge-icon icon-blue">üéØ</div><div class="goal-badge-text"><div class="goal-badge-label">Ziel</div><div class="goal-badge-value" id="userGoal">Gehorsam verbessern</div></div></div>
                <div class="goal-badge"><div class="goal-badge-icon icon-orange">‚ö†Ô∏è</div><div class="goal-badge-text"><div class="goal-badge-label">Verhaltensproblem</div><div class="goal-badge-value" id="userProblem">Trennungsangst</div></div></div>
            </div>
        </div>
        <div class="motivation-text">
            <p>Mit den richtigen √úbungen und einem strukturierten Plan l√§sst sich <span class="problem-highlight" id="problemTextMotivation">das Problem</span> abtrainieren.</p>
            <p class="motivation-question">In welcher Zeit soll <span id="dogNamePlan">dein Hund</span> das Problem l√∂sen?</p>
        </div>
        <div class="pricing-section">
            <!-- 1-Monat: 24,99‚Ç¨ = 0,83‚Ç¨/Tag -->
            <div class="pricing-card" data-plan="1month"><div class="pricing-header"><div class="pricing-left"><div class="pricing-radio"></div><span class="pricing-name">1-MONATS-PLAN</span></div><div class="pricing-right"><div class="pricing-price"><span class="price-currency">‚Ç¨</span><span class="price-amount">0</span><span class="price-cents">,83</span><span class="price-period">pro Tag</span></div><div class="price-old">‚Ç¨1,67</div></div></div></div>
            <!-- 3-Monat: 29,99‚Ç¨ = 0,33‚Ç¨/Tag - VORAUSGEW√ÑHLT -->
            <div class="pricing-card popular selected" data-plan="3month"><div class="popular-badge">‚≠ê Beliebteste Wahl</div><div class="pricing-header"><div class="pricing-left"><div class="pricing-radio"></div><span class="pricing-name">3-MONATS-PLAN</span></div><div class="pricing-right"><div class="pricing-price"><span class="price-currency">‚Ç¨</span><span class="price-amount">0</span><span class="price-cents">,33</span><span class="price-period">pro Tag</span></div><div class="price-old">‚Ç¨0,89</div></div></div></div>
            <!-- 6-Monat: 49,99‚Ç¨ = 0,27‚Ç¨/Tag -->
            <div class="pricing-card" data-plan="6month"><div class="pricing-header"><div class="pricing-left"><div class="pricing-radio"></div><span class="pricing-name">6-MONATS-PLAN</span></div><div class="pricing-right"><div class="pricing-price"><span class="price-currency">‚Ç¨</span><span class="price-amount">0</span><span class="price-cents">,27</span><span class="price-period">pro Tag</span></div><div class="price-old">‚Ç¨0,67</div></div></div></div>
        </div>
        <div class="disclaimer">‚úì Einmalzahlung ‚Ä¢ Kein Abo ‚Ä¢ 30 Tage Geld-zur√ºck-Garantie ‚Ä¢ <a href="agb.html">AGB</a></div>
        <button class="cta-button glow" onclick="getMyPlan()">Jetzt Plan sichern</button>
        <div class="payment-logos"><img src="sepa-logo.png" alt="SEPA"><img src="paypal-logo.png" alt="PayPal"><img src="visa-logo.png" alt="Visa"><img src="klarna-logo.png" alt="Klarna"><img src="mastercard-logo.png" alt="Mastercard"></div>
        <div class="guarantee"><svg viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/></svg>30-Tage Geld-zur√ºck-Garantie</div>
        <div class="testimonials-section">
            <div class="section-header"><h2 class="section-title">Echte Erfolgsgeschichten</h2><p class="section-subtitle">mit unserem Trainingsplan</p></div>
            <div class="testimonial-card"><div class="testimonial-image-single"><img src="Testimonial1.png" alt="Bella" style="width:100%;height:100%;object-fit:cover;border-radius:8px;"></div><div class="testimonial-header"><div><div class="testimonial-name">Bella</div><div class="testimonial-problem">Problem: <span>Leinenaggression</span></div></div></div><p class="testimonial-text">Mein Hund hat fr√ºher jeden anderen Hund angebellt. Nach 3 Wochen mit dem Plan k√∂nnen wir endlich entspannt spazieren gehen.</p></div>
            <div class="testimonial-card"><div class="testimonial-image-single"><img src="Testimonial2.png" alt="Max" style="width:100%;height:100%;object-fit:cover;border-radius:8px;"></div><div class="testimonial-header"><div><div class="testimonial-name">Max</div><div class="testimonial-problem">Problem: <span>Hyperaktivit√§t</span></div></div></div><p class="testimonial-text">Max war st√§ndig aufgedreht und konnte nicht stillsitzen. Die t√§glichen 10-Minuten-√úbungen haben wahre Wunder gewirkt!</p></div>
        </div>
        <div class="benefits-box"><h2 class="benefits-title">Das bekommst du</h2><ul class="benefits-list"><li>‚úì Schnell den Gehorsam verbessern</li><li>‚úì √úbersch√ºssige Energie in den Griff bekommen</li><li>‚úì Neue Trainingstechniken lernen</li><li>‚úì <span id="userProblemBenefit">Verhaltensprobleme</span> l√∂sen</li><li>‚úì Dauerhaft hohes Gehorsamkeitslevel halten</li><li>‚úì 20+ Aufgaben f√ºr <span id="dogName4">deinen Hund</span>s mentale Gesundheit</li><li>‚úì Gl√ºckliches Zusammenleben genie√üen</li></ul></div>
        <div class="trustpilot-slider"><div class="trustpilot-track" id="tpTrack"><div class="trustpilot-review"><div class="trustpilot-stars"><span class="tp-star">‚òÖ</span><span class="tp-star">‚òÖ</span><span class="tp-star">‚òÖ</span><span class="tp-star">‚òÖ</span><span class="tp-star">‚òÖ</span></div><p class="trustpilot-text">Sehr gut erkl√§rt und schnell umsetzbar!</p><p class="trustpilot-name">Sandra M.</p></div><div class="trustpilot-review"><div class="trustpilot-stars"><span class="tp-star">‚òÖ</span><span class="tp-star">‚òÖ</span><span class="tp-star">‚òÖ</span><span class="tp-star">‚òÖ</span><span class="tp-star">‚òÖ</span></div><p class="trustpilot-text">Tolle Beispiele, die wirklich funktionieren.</p><p class="trustpilot-name">Thomas K.</p></div><div class="trustpilot-review"><div class="trustpilot-stars"><span class="tp-star">‚òÖ</span><span class="tp-star">‚òÖ</span><span class="tp-star">‚òÖ</span><span class="tp-star">‚òÖ</span><span class="tp-star">‚òÖ</span></div><p class="trustpilot-text">Einfache Anleitungen, schnelle Ergebnisse!</p><p class="trustpilot-name">Julia R.</p></div></div><div class="trustpilot-dots"><span class="tp-dot active" data-index="0"></span><span class="tp-dot" data-index="1"></span><span class="tp-dot" data-index="2"></span></div></div>
        <div class="guarantee-box"><h3 class="guarantee-title">30-Tage Geld-zur√ºck-Garantie</h3><p class="guarantee-text">Wir sind √ºberzeugt, dass unser Plan funktioniert. Falls nicht, erstatten wir dir den vollen Betrag zur√ºck ‚Äì ohne Wenn und Aber.</p><div class="guarantee-badge"><svg viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/></svg></div></div>
        <div class="faq-section"><h2 class="faq-title">H√§ufige Fragen</h2><div class="faq-item"><div class="faq-question"><div class="faq-icon"><svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div><span class="faq-question-text">Wie bekomme ich meinen Trainingsplan?</span></div><p class="faq-answer">Du erh√§ltst deinen personalisierten Trainingsplan sofort per E-Mail nach dem Kauf.</p></div><div class="faq-item"><div class="faq-question"><div class="faq-icon"><svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div><span class="faq-question-text">Wie viel Zeit brauche ich t√§glich?</span></div><p class="faq-answer">Nur 10 bis 15 Minuten am Tag. Perfekt f√ºr jeden Alltag!</p></div><div class="faq-item"><div class="faq-question"><div class="faq-icon"><svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div><span class="faq-question-text">Funktioniert das auch bei meinem Hund?</span></div><p class="faq-answer">Ja! Unser Plan ist personalisiert. Falls du keine Verbesserung siehst, bekommst du dein Geld zur√ºck.</p></div></div>
        <button class="cta-button glow" onclick="getMyPlan()">Jetzt Plan sichern</button>
    </div>
    <footer class="footer"><p>¬© 2025 Mein WauWerk. Alle Rechte vorbehalten.</p><p><a href="datenschutz.html">Datenschutz</a> ‚Ä¢ <a href="impressum.html">Impressum</a> ‚Ä¢ <a href="agb.html">AGB</a></p></footer>
    <div class="checkout-overlay" id="checkoutPopup"><div class="checkout-popup"><div class="checkout-header"><button class="checkout-close" onclick="closeCheckoutPopup()">√ó</button><h2 class="checkout-title">Dein Plan f√ºr <span id="checkoutDogName">deinen Hund</span></h2></div><div class="checkout-body"><div class="checkout-step-email" id="checkoutStepEmail"><div class="checkout-email-icon">üìß</div><div class="checkout-email-title">Wohin sollen wir deinen Plan schicken?</div><div class="checkout-email-subtitle">Gib deine E-Mail ein, um deinen personalisierten Trainingsplan zu erhalten.</div><input type="email" class="checkout-email-input" id="checkoutEmailInput" placeholder="deine@email.de" onkeypress="if(event.key==='Enter')submitEmail()"><button class="checkout-email-btn" onclick="submitEmail()">Weiter zum Plan ‚Üí</button><div class="checkout-trust-badge"><div class="trust-stars"><span class="trust-star"><svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg></span><span class="trust-star"><svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg></span><span class="trust-star"><svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg></span><span class="trust-star"><svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg></span><span class="trust-star"><svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg></span></div><span class="trust-text"><strong>4.8/5</strong> von 2.847 Hundebesitzern</span></div><div class="checkout-email-privacy">üîí Deine Daten sind sicher. Kein Spam.</div></div><div class="checkout-step-1 hidden" id="checkoutStep1"><div class="checkout-plan-card"><div class="checkout-plan-image">üêï</div><div class="checkout-plan-info"><div class="checkout-plan-name">Personalisierter Trainingsplan</div><div class="checkout-plan-duration" id="checkoutPlanDuration">3-Monats-Plan</div></div><div class="checkout-plan-price-box"><div class="checkout-plan-price" id="checkoutPlanPrice">‚Ç¨29,99</div><div class="checkout-plan-access">Voller Zugang</div></div></div><div class="checkout-features-compact"><div class="checkout-feature-row">‚úì 20+ √úbungen f√ºr <span id="checkoutDogProblem">dein Problem</span></div><div class="checkout-feature-row">‚úì Pers√∂nlicher Trainer-Support</div><div class="checkout-feature-row">‚úì 20+ individuelle Aufgaben</div><div class="checkout-feature-row">‚úì 3 Spezialmodule gratis dazu</div></div><div class="checkout-total-compact"><div><span class="checkout-total-label">Gesamt:</span><span class="checkout-total-saved" id="checkoutSaved">Du sparst ‚Ç¨271,96</span></div><div class="checkout-total-price" id="checkoutTotalPrice">‚Ç¨29,99</div></div><div class="checkout-guarantee-compact">üõ°Ô∏è 30 Tage Geld-zur√ºck-Garantie</div><button class="checkout-continue-btn" onclick="goToPaymentStep()">WEITER ZUR ZAHLUNG</button></div><div class="checkout-step-2" id="checkoutStep2"><h3 style="text-align:center;margin-bottom:20px;font-size:18px;">Zahlungsmethode w√§hlen</h3><div class="checkout-summary"><div class="checkout-summary-row"><span>Trainingsplan f√ºr <span id="checkoutDogName3">Hund</span></span><span><span class="checkout-summary-old" id="checkoutOldPrice">‚Ç¨79,99</span><span id="checkoutNewPrice">‚Ç¨29,99</span></span></div><div class="checkout-summary-row" id="bonusModuleRow"><span>Bonus-Module</span><span><span class="checkout-summary-old">‚Ç¨221,95</span><span>‚Ç¨0</span></span></div><div class="checkout-summary-row total"><span>Gesamt</span><span id="checkoutFinalPrice">‚Ç¨29,99</span></div><div class="checkout-summary-saved" id="checkoutSaved2">Du sparst ‚Ç¨271,96</div></div><div class="checkout-error" id="checkoutError"></div><div class="stripe-element-container"><div id="payment-element"></div></div><button class="checkout-pay-btn" id="checkoutPayBtn" onclick="submitPayment()">üîí Jetzt bezahlen</button><div class="payment-icons"><img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg" alt="Visa"><img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" alt="Mastercard"><img src="https://upload.wikimedia.org/wikipedia/commons/b/b5/PayPal.svg" alt="PayPal"><img src="klarna-logo.png" alt="Klarna"></div><button class="checkout-back" onclick="goBackToStep1()">‚Üê Zur√ºck zur √úbersicht</button></div></div></div></div>
    <div class="exit-popup-overlay" id="exitPopup"><div class="exit-popup"><button class="exit-popup-close" onclick="closeExitPopup()">√ó</button><div class="exit-popup-emoji">üêï</div><h3 class="exit-popup-title">Warte kurz!</h3><p class="exit-popup-text">Mit unserem Plan trainierst du <span class="exit-popup-highlight" id="popupProblem">das Problem</span> gezielt ab.</p><div class="exit-popup-bonus"><div class="exit-popup-bonus-title">üéÅ Das bekommst du zus√§tzlich:</div><div class="exit-popup-bonus-list"><div>‚úì <strong>6 Bonus-√úbungen</strong> f√ºr schnellere Erfolge</div><div>‚úì <strong>30 Tage Geld-zur√ºck-Garantie</strong></div><div>‚úì <strong>Pers√∂nlicher Support</strong></div><div>‚úì <strong>Sofortiger Zugang</strong></div></div></div><button class="exit-popup-cta" onclick="closeExitPopup();document.querySelector('.cta-button').click();">Jetzt Plan sichern üöÄ</button><button class="exit-popup-skip" onclick="closeExitPopup()">Nein danke, ich √ºberlege noch</button></div></div>
<script>
// ==================== URL RABATTCODE SYSTEM ====================
const urlParams = new URLSearchParams(window.location.search);
const discountCode = urlParams.get('code');
let hasUrlDiscount = false;
if (discountCode) {
    hasUrlDiscount = true;
    localStorage.setItem('discountCode', discountCode);
    console.log('üéÅ Rabattcode aus URL:', discountCode);
}

const dogName = localStorage.getItem('dogName') || 'deinen Hund';
const dogGoal = localStorage.getItem('dogGoal') || 'obedience';
const dogProblem = localStorage.getItem('dogProblem') || '';
const territorialAggression = localStorage.getItem('territorialAggression') || '';

document.getElementById('dogName1').textContent = dogName;
document.getElementById('dogName2').textContent = dogName;
document.getElementById('dogName3').textContent = dogName;
document.getElementById('dogName4').textContent = dogName;
document.getElementById('dogNamePlan').textContent = dogName;

const goalMap = {'basics':'Grundlagen lernen','obedience':'Gehorsam verbessern','commands':'Kommandos beibringen','bond':'Bindung st√§rken','behavior':'Verhalten verbessern','anxiety':'√Ñngste abbauen','potty':'Toiletten-Routine','none':'Allgemeines Training'};
document.getElementById('userGoal').textContent = goalMap[dogGoal] || 'Gehorsam verbessern';

let problemText = 'Ungehorsam';
if (territorialAggression === 'yes') { problemText = 'Territoriale Aggression'; }
else if (dogProblem) {
    const problemMap = {'pulling':'Leinenziehen','barking':'√úberm√§√üiges Bellen','aggression':'Aggression','anxiety':'Trennungsangst','jumping':'Anspringen','recall':'Kommt nicht zur√ºck','energy':'√úberm√§√üige Energie','destructive':'Zerst√∂rerisches Verhalten','soiling':'In die Wohnung machen'};
    problemText = problemMap[dogProblem] || dogProblem;
}
document.getElementById('userProblem').textContent = problemText;
document.getElementById('userProblemBenefit').textContent = problemText;
document.getElementById('problemLabel1').textContent = problemText;
document.getElementById('problemLabel2').textContent = problemText;
document.getElementById('problemTextMotivation').textContent = problemText;

const problemValueMap = {'pulling':{bad:'Stark',good:'Kontrolliert'},'barking':{bad:'H√§ufig',good:'Ruhig'},'aggression':{bad:'Kritisch',good:'Friedlich'},'anxiety':{bad:'Stark',good:'Entspannt'},'jumping':{bad:'St√§ndig',good:'Kontrolliert'},'recall':{bad:'Ignoriert',good:'Zuverl√§ssig'},'energy':{bad:'√úberm√§√üig',good:'Ausgeglichen'},'destructive':{bad:'H√§ufig',good:'Gestoppt'},'soiling':{bad:'Regelm√§√üig',good:'Stubenrein'}};
const defaultValues = {bad:'Kritisch',good:'Gel√∂st'};
const values = problemValueMap[dogProblem] || defaultValues;
document.getElementById('problemValue1').textContent = territorialAggression === 'yes' ? 'Kritisch' : values.bad;
document.getElementById('problemValue2').textContent = territorialAggression === 'yes' ? 'Friedlich' : values.good;

// Timer
let timeLeft, timerExpired = false;
function initializeTimer() {
    if (hasUrlDiscount) {
        const timerBar = document.getElementById('timerBar');
        timerBar.classList.add('code-active');
        timerBar.innerHTML = 'üéÅ Dein Rabattcode <span>' + discountCode + '</span> ist aktiv!';
        timerExpired = false;
        return;
    }
    const savedStartTime = localStorage.getItem('wauwerk_timerStartTime');
    const timerDuration = 10 * 60;
    if (savedStartTime) {
        const elapsedSeconds = Math.floor((Date.now() - parseInt(savedStartTime)) / 1000);
        timeLeft = Math.max(0, timerDuration - elapsedSeconds);
    } else {
        timeLeft = timerDuration;
        localStorage.setItem('wauwerk_timerStartTime', Date.now().toString());
    }
    updateTimer();
}
function updateTimer() {
    if (hasUrlDiscount) return;
    if (timeLeft <= 0) { timerExpired = true; document.getElementById('timer').textContent = 'ABGELAUFEN'; switchToNormalPrices(); return; }
    const minutes = Math.floor(timeLeft / 60), seconds = timeLeft % 60;
    document.getElementById('timer').textContent = `${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
    timeLeft--;
    setTimeout(updateTimer, 1000);
}
function switchToNormalPrices() {
    document.querySelectorAll('.price-old').forEach(el => el.style.display = 'none');
    const cards = document.querySelectorAll('.pricing-card');
    // 1-Monat normal: 49,99‚Ç¨ = 1,67‚Ç¨/Tag
    cards[0].querySelector('.price-amount').textContent = '1';
    cards[0].querySelector('.price-cents').textContent = ',67';
    // 3-Monat normal: 79,99‚Ç¨ = 0,89‚Ç¨/Tag
    cards[1].querySelector('.price-amount').textContent = '0';
    cards[1].querySelector('.price-cents').textContent = ',89';
    // 6-Monat normal: 119,99‚Ç¨ = 0,67‚Ç¨/Tag
    cards[2].querySelector('.price-amount').textContent = '0';
    cards[2].querySelector('.price-cents').textContent = ',67';
}
initializeTimer();

// Plan Selection - 3-Monat vorausgew√§hlt
const pricingCards = document.querySelectorAll('.pricing-card');
let selectedPlan = '3month';
const planDetails = {'1month':{price:'‚Ç¨24,99',priceNormal:'‚Ç¨49,99'},'3month':{price:'‚Ç¨29,99',priceNormal:'‚Ç¨79,99'},'6month':{price:'‚Ç¨49,99',priceNormal:'‚Ç¨119,99'}};
pricingCards.forEach(card => card.addEventListener('click', function() {
    pricingCards.forEach(c => c.classList.remove('selected'));
    this.classList.add('selected');
    selectedPlan = this.dataset.plan;
}));

// Supabase
const SUPABASE_URL = 'https://xomsibpyksrzrnixbdwf.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhvbXNpYnB5a3NyenJuaXhiZHdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NjMxMjIsImV4cCI6MjA3MjIzOTEyMn0.ZgCwog94HUHz39lbGMJkFPeZ6c-nL4AMFFTz5AgwnKE';

function getCookie(name) { const value = `; ${document.cookie}`; const parts = value.split(`; ${name}=`); if (parts.length === 2) return parts.pop().split(';').shift(); return null; }
function generateEventId() { return 'evt_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9); }
function parseJSON(str) { try { return JSON.parse(str || '[]'); } catch(e) { return []; } }

async function saveToSupabase() {
    const fbp = getCookie('_fbp') || null;
    const fbclid = urlParams.get('fbclid') || localStorage.getItem('fbclid') || null;
    const fbc = getCookie('_fbc') || (fbclid ? 'fb.1.' + Date.now() + '.' + fbclid : null);
    const fb_event_id = generateEventId();
    localStorage.setItem('fb_event_id', fb_event_id);
    const answers = {
        dog_name: localStorage.getItem('dogName'), dog_age: localStorage.getItem('dogAge'), dog_breed: localStorage.getItem('dogBreed'),
        dog_gender: localStorage.getItem('dogGender'), dog_goal: localStorage.getItem('dogGoal'), dog_problem: localStorage.getItem('dogProblem'),
        email: localStorage.getItem('userEmail') || null, discount_code: discountCode || null,
        utm_source: urlParams.get('utm_source') || localStorage.getItem('utm_source') || null,
        utm_medium: urlParams.get('utm_medium') || localStorage.getItem('utm_medium') || null,
        utm_campaign: urlParams.get('utm_campaign') || localStorage.getItem('utm_campaign') || null,
        fbclid: fbclid, fbp: fbp, fbc: fbc, fb_event_id: fb_event_id
    };
    const leadData = {
        dog_name: localStorage.getItem('dogName'), selected_plan: selectedPlan,
        price: (timerExpired && !hasUrlDiscount) ? planDetails[selectedPlan].priceNormal : planDetails[selectedPlan].price,
        timer_expired: timerExpired && !hasUrlDiscount, status: 'pending', answers: answers, email: localStorage.getItem('userEmail') || null
    };
    localStorage.setItem('wauwerk_answers', JSON.stringify(answers));
    try {
        const response = await fetch(`${SUPABASE_URL}/rest/v1/wauwerk_leads`, {
            method: 'POST', headers: {'Content-Type':'application/json','apikey':SUPABASE_ANON_KEY,'Authorization':`Bearer ${SUPABASE_ANON_KEY}`,'Prefer':'return=representation'},
            body: JSON.stringify(leadData)
        });
        const data = await response.json();
        return data[0]?.id || null;
    } catch (error) { console.error('Supabase error:', error); return null; }
}

// Trustpilot Slider
let tpCurrentSlide = 0;
const tpTrack = document.getElementById('tpTrack');
const tpDots = document.querySelectorAll('.tp-dot');
function goToTpSlide(index) { tpCurrentSlide = index; tpTrack.style.transform = `translateX(-${index * 100}%)`; tpDots.forEach((dot, i) => dot.classList.toggle('active', i === index)); }
tpDots.forEach(dot => dot.addEventListener('click', () => goToTpSlide(parseInt(dot.dataset.index))));
setInterval(() => { tpCurrentSlide = (tpCurrentSlide + 1) % 3; goToTpSlide(tpCurrentSlide); }, 4000);

// Exit Popup
let exitPopupShown = false;
if (localStorage.getItem('wentToStripe') === 'true' && !sessionStorage.getItem('exitPopupShown')) { setTimeout(() => showExitPopup(), 500); }
document.addEventListener('mouseout', function(e) { if (e.clientY < 10 && !exitPopupShown && !sessionStorage.getItem('exitPopupShown')) showExitPopup(); });
function showExitPopup() {
    if (exitPopupShown) return;
    exitPopupShown = true;
    sessionStorage.setItem('exitPopupShown', 'true');
    const popupProblemEl = document.getElementById('popupProblem');
    if (popupProblemEl) popupProblemEl.textContent = problemText;
    document.getElementById('exitPopup').classList.add('active');
}
function closeExitPopup() { document.getElementById('exitPopup').classList.remove('active'); localStorage.removeItem('wentToStripe'); }

// Checkout
const STRIPE_PUBLIC_KEY = 'pk_live_51R4LfjAI8IbKLr6RO63Mf5cZmwW8GZCV8fveuqas0sQU8tVtGGISXj1WxQBN5LjUu7IMt0swCgIp8XEFDFZKqgSI00N5iaRkiy';
let stripe = null, elements = null, paymentElement = null, currentLeadId = null, clientSecret = null, userEmail = null;

// Preise: 1-Monat 24,99‚Ç¨, 3-Monat 29,99‚Ç¨, 6-Monat 49,99‚Ç¨
const checkoutPrices = {
    '1month': { discount: 24.99, normal: 49.99, oldTotal: 271.94, duration: '1-Monats-Plan' },
    '3month': { discount: 29.99, normal: 79.99, oldTotal: 301.94, duration: '3-Monats-Plan' },
    '6month': { discount: 49.99, normal: 119.99, oldTotal: 341.94, duration: '6-Monats-Plan' }
};

function submitEmail() {
    const emailInput = document.getElementById('checkoutEmailInput');
    const email = emailInput.value.trim();
    if (!email || !email.includes('@') || !email.includes('.')) { emailInput.style.borderColor = '#e74c3c'; return; }
    userEmail = email;
    localStorage.setItem('userEmail', email);
    if (currentLeadId) {
        fetch(`${SUPABASE_URL}/rest/v1/wauwerk_leads?id=eq.${currentLeadId}`, {
            method: 'PATCH', headers: {'apikey':SUPABASE_ANON_KEY,'Authorization':`Bearer ${SUPABASE_ANON_KEY}`,'Content-Type':'application/json'},
            body: JSON.stringify({email: email})
        });
    }
    document.getElementById('checkoutStepEmail').classList.add('hidden');
    document.getElementById('checkoutStep1').classList.remove('hidden');
}

async function openCheckoutPopup() {
    currentLeadId = await saveToSupabase();
    const priceData = checkoutPrices[selectedPlan] || checkoutPrices['3month'];
    const useDiscount = hasUrlDiscount || !timerExpired;
    const price = useDiscount ? priceData.discount : priceData.normal;
    const oldPrice = priceData.normal;
    const saved = (priceData.oldTotal - price).toFixed(2);
    
    document.getElementById('checkoutDogName').textContent = dogName;
    document.getElementById('checkoutDogName3').textContent = dogName;
    document.getElementById('checkoutPlanDuration').textContent = priceData.duration;
    document.getElementById('checkoutPlanPrice').textContent = `‚Ç¨${price.toFixed(2).replace('.',',')}`;
    document.getElementById('checkoutTotalPrice').textContent = `‚Ç¨${price.toFixed(2).replace('.',',')}`;
    
    // Durchgestrichenen Preis nur zeigen wenn Rabatt aktiv
    const oldPriceEl = document.getElementById('checkoutOldPrice');
    if (!useDiscount) {
        oldPriceEl.style.display = 'none';
        document.getElementById('bonusModuleRow').style.display = 'none';
        document.getElementById('checkoutSaved').style.display = 'none';
        document.getElementById('checkoutSaved2').style.display = 'none';
    } else {
        oldPriceEl.style.display = 'inline';
        oldPriceEl.textContent = `‚Ç¨${oldPrice.toFixed(2).replace('.',',')}`;
        document.getElementById('bonusModuleRow').style.display = 'flex';
        document.getElementById('checkoutSaved').style.display = 'block';
        document.getElementById('checkoutSaved2').style.display = 'block';
        document.getElementById('checkoutSaved').textContent = `Du sparst ‚Ç¨${saved.replace('.',',')}`;
        document.getElementById('checkoutSaved2').textContent = `Du sparst ‚Ç¨${saved.replace('.',',')}`;
    }
    
    document.getElementById('checkoutNewPrice').textContent = `‚Ç¨${price.toFixed(2).replace('.',',')}`;
    document.getElementById('checkoutFinalPrice').textContent = `‚Ç¨${price.toFixed(2).replace('.',',')}`;
    
    const problemLabels = {'pulling':'Leinenziehen','barking':'Bellen','aggression':'Aggression','anxiety':'Trennungsangst','jumping':'Anspringen','recall':'R√ºckruf','energy':'Hyperaktivit√§t','destructive':'Zerst√∂rungswut','soiling':'Stubenreinheit'};
    const checkoutDogProblem = document.getElementById('checkoutDogProblem');
    if (checkoutDogProblem) checkoutDogProblem.textContent = problemLabels[dogProblem] || 'dein Problem';
    
    document.getElementById('checkoutStepEmail').classList.remove('hidden');
    document.getElementById('checkoutStep1').classList.add('hidden');
    document.getElementById('checkoutStep2').classList.remove('active');
    document.getElementById('checkoutEmailInput').value = '';
    document.getElementById('checkoutPopup').classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeCheckoutPopup() {
    document.getElementById('checkoutPopup').classList.remove('active');
    document.body.style.overflow = '';
    if (!sessionStorage.getItem('exitPopupShown')) setTimeout(() => showExitPopup(), 300);
}

async function goToPaymentStep() {
    document.getElementById('checkoutStep1').classList.add('hidden');
    document.getElementById('checkoutStep2').classList.add('active');
    if (!stripe) stripe = Stripe(STRIPE_PUBLIC_KEY);
    try {
        const effectiveTimerExpired = hasUrlDiscount ? false : timerExpired;
        const response = await fetch('/api/wauwerk-checkout', {
            method: 'POST', headers: {'Content-Type':'application/json'},
            body: JSON.stringify({
                plan: selectedPlan, timerExpired: effectiveTimerExpired, dogName: dogName, leadId: currentLeadId,
                email: userEmail || localStorage.getItem('userEmail') || '', discountCode: discountCode || '',
                fbp: getCookie('_fbp') || '', fbc: getCookie('_fbc') || '', fb_event_id: localStorage.getItem('fb_event_id') || ''
            })
        });
        const data = await response.json();
        if (data.error) { showCheckoutError(data.error); return; }
        clientSecret = data.clientSecret;
        elements = stripe.elements({clientSecret: clientSecret, appearance: {theme:'stripe',variables:{colorPrimary:'#C4A576',borderRadius:'8px'}}, locale:'de'});
        paymentElement = elements.create('payment', {layout:{type:'tabs',defaultCollapsed:false}, paymentMethodOrder:['paypal','klarna','card']});
        paymentElement.mount('#payment-element');
    } catch (error) { console.error('Checkout Error:', error); showCheckoutError('Verbindungsfehler. Bitte versuche es erneut.'); }
}

function goBackToStep1() { document.getElementById('checkoutStep1').classList.remove('hidden'); document.getElementById('checkoutStep2').classList.remove('active'); }

async function submitPayment() {
    const payBtn = document.getElementById('checkoutPayBtn');
    payBtn.disabled = true;
    payBtn.innerHTML = '<span class="spinner"></span> Wird verarbeitet...';
    hideCheckoutError();
    try {
        const { error } = await stripe.confirmPayment({ elements, confirmParams: { return_url: window.location.origin + '/danke.html?lead_id=' + currentLeadId } });
        if (error) { showCheckoutError(error.message); payBtn.disabled = false; payBtn.innerHTML = 'üîí Jetzt bezahlen'; }
    } catch (err) { showCheckoutError('Zahlung fehlgeschlagen.'); payBtn.disabled = false; payBtn.innerHTML = 'üîí Jetzt bezahlen'; }
}

function showCheckoutError(message) { const el = document.getElementById('checkoutError'); el.textContent = message; el.classList.add('visible'); }
function hideCheckoutError() { document.getElementById('checkoutError').classList.remove('visible'); }

async function getMyPlan() { openCheckoutPopup(); }
</script>
</body>
</html>