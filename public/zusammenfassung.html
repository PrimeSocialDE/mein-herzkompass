<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö - –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —Ä–∞–±–æ—Ç—É –≤ –ì–µ—Ä–º–∞–Ω–∏–∏</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "u1bdqt1zrn");
    </script>
    
    <style>
        body {
            font-family: "Inter", -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            min-height: 100vh;
            color: #2D3748;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }

        .logo {
            margin-bottom: 15px;
        }

        .logo img {
            height: 45px;
            width: auto;
        }

        .status-badge {
            background: #22c55e;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 15px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            color: #1e3c72;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            color: #4a5568;
            margin: 0;
        }

        .summary-sections {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .section-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            overflow: hidden;
        }

        .section-header {
            background: #1e3c72;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            margin: 0;
        }

        .edit-button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .edit-button:hover {
            background: rgba(255,255,255,0.3);
        }

        .data-table {
            width: 100%;
        }

        .data-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-row:last-child {
            border-bottom: none;
        }

        .field-label {
            padding: 12px 15px;
            background: #f8fafc;
            font-size: 13px;
            font-weight: 600;
            color: #4a5568;
            border-right: 1px solid #e2e8f0;
        }

        .field-value {
            padding: 12px 15px;
            font-size: 13px;
            color: #2d3748;
            word-break: break-word;
        }

        .empty-value {
            color: #a0aec0;
            font-style: italic;
        }

        .continue-button {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }

        .continue-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(30, 60, 114, 0.3);
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header {
                padding: 15px;
                margin-bottom: 20px;
            }

            .logo img {
                height: 35px;
            }

            .header h1 {
                font-size: 20px;
                margin-bottom: 6px;
            }

            .header p {
                font-size: 12px;
            }

            .summary-sections {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .section-header {
                padding: 12px 15px;
            }

            .section-title {
                font-size: 14px;
            }

            .field-label, .field-value {
                padding: 10px 12px;
                font-size: 12px;
            }

            .status-badge {
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <img src="LogoGer.png" alt="Germany Start Logo">
            </div>
            <div class="status-badge">–ó–∞—è–≤–ª–µ–Ω–∏–µ –ø–æ—á—Ç–∏ –≥–æ—Ç–æ–≤–æ</div>
            <h1>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ</h1>
            <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏</p>
        </div>

        <div class="summary-sections">
            <!-- Section 1: Personal Data -->
            <div class="section-card">
                <div class="section-header">
                    <h3 class="section-title">1. –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                    <button class="edit-button" onclick="editSection(1)">
                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
                <div class="data-table" id="personalDataTable">
                    <!-- Personal data will be loaded here -->
                </div>
            </div>

            <!-- Section 2: Family & Entry -->
            <div class="section-card">
                <div class="section-header">
                    <h3 class="section-title">2. –°–µ–º—å—è –∏ –≤—ä–µ–∑–¥</h3>
                    <button class="edit-button" onclick="editSection(2)">
                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
                <div class="data-table" id="familyDataTable">
                    <!-- Family data will be loaded here -->
                </div>
            </div>

            <!-- Section 3: Goals & Final -->
            <div class="section-card">
                <div class="section-header">
                    <h3 class="section-title">3. –¶–µ–ª–∏ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
                    <button class="edit-button" onclick="editSection(3)">
                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
                <div class="data-table" id="finalDataTable">
                    <!-- Final data will be loaded here -->
                </div>
            </div>
        </div>

        <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; margin-bottom: 20px;">
            <h3 style="font-size: 18px; font-weight: 700; color: #1e3c72; margin-bottom: 20px;">–¢—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–∏–µ</h3>
            
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <div style="display: flex; align-items: flex-start; gap: 12px;">
                    <input type="checkbox" id="data_consent" required style="margin-top: 4px; transform: scale(1.2);">
                    <label for="data_consent" style="font-size: 14px; color: #2d3748; line-height: 1.5; cursor: pointer;">
                        <span style="color: #e53e3e;">*</span> –Ø –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é, —á—Ç–æ –º–æ–∏ –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∏—Ö –∑–∞—è–≤–ª–µ–Ω–∏–π –ø–æ ¬ß24. –î–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–ª–µ–Ω–∏—è.
                    </label>
                </div>
                
                <div style="display: flex; align-items: flex-start; gap: 12px;">
                    <input type="checkbox" id="fee_consent" required style="margin-top: 4px; transform: scale(1.2);">
                    <label for="fee_consent" style="font-size: 14px; color: #2d3748; line-height: 1.5; cursor: pointer;">
                        <span style="color: #e53e3e;">*</span> –Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å —Ç–µ–º, —á—Ç–æ –∑–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –º–æ–∏—Ö –∑–∞—è–≤–ª–µ–Ω–∏–π –≤–∑–∏–º–∞–µ—Ç—Å—è <strong>–µ–¥–∏–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–ª–∞—Ç–∞ –∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ —Ä–∞–∑–º–µ—Ä–µ 1.050 ‚Ç¥ (24,99 ‚Ç¨)</strong>. –û–Ω–∞ –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–ª–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ–æ—Ä–º –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.
                    </label>
                </div>
            </div>

            <div id="consent-error" style="color: #e53e3e; font-size: 12px; margin-top: 10px; display: none;">
                –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –æ–±–∞ –ø—É–Ω–∫—Ç–∞ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è.
            </div>
            
            <!-- What happens next -->
            <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #1e3c72;">
                <h4 style="font-size: 14px; font-weight: 700; color: #1e3c72; margin-bottom: 8px;">üìß –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è?</h4>
                <p style="font-size: 13px; color: #4a5568; margin: 0; line-height: 1.4;">
                    –í —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤ –í—ã –ø–æ–ª—É—á–∏—Ç–µ –≤—Å–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø–æ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç–µ + —Ç–æ—á–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ –≤–µ–¥–æ–º—Å—Ç–≤ + —á—Ç–æ —Ç–∞–º –≥–æ–≤–æ—Ä–∏—Ç—å. –ü—Ä–æ—Å—Ç–æ —Ä–∞—Å–ø–µ—á–∞—Ç–∞–π—Ç–µ –∏ –ø–æ–¥–∞–π—Ç–µ.
                </p>
            </div>
        </div>

        <button class="continue-button" onclick="submitApplication()">
            –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
        </button>
    </div>

    <script>
        // Russian field translations using German localStorage keys
        const fieldTranslations = {
            // Personal data
            vorname: '–ò–º—è',
            nachname: '–§–∞–º–∏–ª–∏—è',
            geburtsdatum: '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è',
            geburtsort: '–ú–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è',
            staatsangehoerigkeit: '–ì—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ',
            geschlecht: '–ü–æ–ª',
            familienstand: '–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ',
            passnummer: '–ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞',
            ausstellungsort: '–ú–µ—Å—Ç–æ –≤—ã–¥–∞—á–∏',
            ausstellungsdatum: '–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏',
            gueltig_bis: '–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –¥–æ',
            telefon: '–¢–µ–ª–µ—Ñ–æ–Ω',
            email: '–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞',
            
            // Family data
            ehepartner_vorhanden: '–ï—Å—Ç—å —Å—É–ø—Ä—É–≥(–∞)',
            ehepartner_name: '–ò–º—è —Å—É–ø—Ä—É–≥–∞(–∏)',
            kinder_vorhanden: '–ï—Å—Ç—å –¥–µ—Ç–∏',
            kinder_namen_alter: '–ò–º–µ–Ω–∞ –∏ –≤–æ–∑—Ä–∞—Å—Ç –¥–µ—Ç–µ–π',
            einreisedatum: '–î–∞—Ç–∞ –≤—ä–µ–∑–¥–∞',
            einreiseweg: '–°–ø–æ—Å–æ–± –≤—ä–µ–∑–¥–∞',
            reiseart: '–¢–∏–ø –ø–æ–µ–∑–¥–∫–∏',
            familie_allein: '–°–µ–º—å—è –≤—ä–µ–∑–∂–∞–µ—Ç –≤–º–µ—Å—Ç–µ',
            unterkunft_vorhanden: '–ñ–∏–ª—å–µ –∏–º–µ–µ—Ç—Å—è',
            wunsch_stadt: '–ñ–µ–ª–∞–µ–º—ã–π –≥–æ—Ä–æ–¥',
            adresse: '–ê–¥—Ä–µ—Å',
            verwandte_freunde: '–†–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏/–¥—Ä—É–∑—å—è',
            
            // Final data
            deutschkenntnisse: '–ó–Ω–∞–Ω–∏–µ –Ω–µ–º–µ—Ü–∫–æ–≥–æ',
            beruf_ukraine: '–ü—Ä–æ—Ñ–µ—Å—Å–∏—è –≤ –£–∫—Ä–∞–∏–Ω–µ',
            arbeiten_deutschland: '–†–∞–±–æ—Ç–∞ –≤ –ì–µ—Ä–º–∞–Ω–∏–∏',
            einkommen_aktuell: '–¢–µ–∫—É—â–∏–π –¥–æ—Ö–æ–¥',
            ersparnisse: '–°–±–µ—Ä–µ–∂–µ–Ω–∏—è',
            finanzielle_unterstuetzung: '–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞',
            grund_deutschland: '–ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–∏–µ–∑–¥–∞ –≤ –ì–µ—Ä–º–∞–Ω–∏—é',
            dauerhaft_bleiben: '–û—Å—Ç–∞—Ç—å—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞',
            kriegsnachweis: '–î–æ–∫—É–º–µ–Ω—Ç –æ –≤–æ–π–Ω–µ',
            vollstaendiger_name: '–ü–æ–ª–Ω–æ–µ –∏–º—è –¥–ª—è –ø–æ–¥–ø–∏—Å–∏',
            datum_heute: '–°–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞',
            datenverarbeitung_zustimmung: '–°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö'
        };

        // Russian value translations
        const valueTranslations = {
            'ja': '–î–∞',
            'nein': '–ù–µ—Ç',
            'weiss_nicht': '–ù–µ –∑–Ω–∞—é',
            'maennlich': '–ú—É–∂—Å–∫–æ–π',
            'weiblich': '–ñ–µ–Ω—Å–∫–∏–π',
            'ledig': '–•–æ–ª–æ—Å—Ç/–ù–µ –∑–∞–º—É–∂–µ–º',
            'verheiratet': '–ñ–µ–Ω–∞—Ç/–ó–∞–º—É–∂–µ–º',
            'geschieden': '–†–∞–∑–≤–µ–¥–µ–Ω(–∞)',
            'verwitwet': '–í–¥–æ–≤–µ—Ü/–í–¥–æ–≤–∞',
            'kein_deutsch': '–ù–µ –≥–æ–≤–æ—Ä—é –ø–æ-–Ω–µ–º–µ—Ü–∫–∏',
            'a1': 'A1 (–±–∞–∑–æ–≤—ã–π)',
            'a2': 'A2 (–±–∞–∑–æ–≤—ã–π)',
            'b1': 'B1 (—Å—Ä–µ–¥–Ω–∏–π)',
            'b2': 'B2 (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π)',
            'c1': 'C1 (—Å–≤–æ–±–æ–¥–Ω—ã–π)',
            'c2': 'C2 (—Ä–æ–¥–Ω–æ–π)',
            'flugzeug': '–°–∞–º–æ–ª–µ—Ç',
            'auto': '–ê–≤—Ç–æ–º–æ–±–∏–ª—å',
            'zug': '–ü–æ–µ–∑–¥',
            'bus': '–ê–≤—Ç–æ–±—É—Å',
            'zu_fuss': '–ü–µ—à–∫–æ–º',
            'mit_familie': '–° —Å–µ–º—å–µ–π',
            'allein': '–û–¥–∏–Ω/–û–¥–Ω–∞',
            'tourismus': '–¢—É—Ä–∏–∑–º',
            'geschaeft': '–ë–∏–∑–Ω–µ—Å',
            'familie_besuch': '–°–µ–º–µ–π–Ω—ã–π –≤–∏–∑–∏—Ç',
            'umzug': '–ü–µ—Ä–µ–µ–∑–¥',
            'sicher': '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å',
            'arbeitsmoeglichkeiten': '–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã',
            'bessere_zukunft': '–õ—É—á—à–µ–µ –±—É–¥—É—â–µ–µ',
            'familie_hier': '–°–µ–º—å—è –∑–¥–µ—Å—å'
        };

        // Load data and populate sections - using German localStorage keys
        document.addEventListener('DOMContentLoaded', function() {
            loadPersonalData();
            loadFamilyData();
            loadFinalData();
        });

        function loadPersonalData() {
            const data = JSON.parse(localStorage.getItem('personalData') || '{}');
            const table = document.getElementById('personalDataTable');
            
            const fields = [
                'vorname', 'nachname', 'geburtsdatum', 'geburtsort', 
                'staatsangehoerigkeit', 'geschlecht', 'familienstand',
                'passnummer', 'ausstellungsort', 'ausstellungsdatum', 'gueltig_bis',
                'telefon', 'email'
            ];
            
            table.innerHTML = fields.map(field => createTableRow(field, data[field])).join('');
        }

        function loadFamilyData() {
            const data = JSON.parse(localStorage.getItem('familyData') || '{}');
            const table = document.getElementById('familyDataTable');
            
            const fields = [
                'ehepartner_vorhanden', 'ehepartner_name', 'kinder_vorhanden', 'kinder_namen_alter',
                'einreisedatum', 'einreiseweg', 'reiseart', 'familie_allein',
                'unterkunft_vorhanden', 'wunsch_stadt', 'adresse', 'verwandte_freunde'
            ];
            
            table.innerHTML = fields.map(field => createTableRow(field, data[field])).join('');
        }

        function loadFinalData() {
            const data = JSON.parse(localStorage.getItem('finalData') || '{}');
            const table = document.getElementById('finalDataTable');
            
            const fields = [
                'deutschkenntnisse', 'beruf_ukraine', 'arbeiten_deutschland',
                'einkommen_aktuell', 'ersparnisse', 'finanzielle_unterstuetzung',
                'grund_deutschland', 'dauerhaft_bleiben', 'kriegsnachweis',
                'vollstaendiger_name', 'datum_heute', 'datenverarbeitung_zustimmung'
            ];
            
            table.innerHTML = fields.map(field => createTableRow(field, data[field])).join('');
        }

        function createTableRow(field, value) {
            const label = fieldTranslations[field] || field;
            let displayValue = value;
            
            if (!value) {
                displayValue = '<span class="empty-value">–ù–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>';
            } else {
                displayValue = valueTranslations[value] || value;
            }
            
            return `
                <div class="data-row">
                    <div class="field-label">${label}</div>
                    <div class="field-value">${displayValue}</div>
                </div>
            `;
        }

        function editSection(sectionNumber) {
            // Redirect to appropriate form step
            const urls = {
                1: '/step1.html', 
                2: '/step2.html',
                3: '/step3.html'
            };
            if (urls[sectionNumber]) {
                window.location.href = urls[sectionNumber];
            }
        }

        function submitApplication() {
            console.log('SUBMIT APPLICATION BUTTON CLICKED');
            
            // Validate consent checkboxes
            const dataConsent = document.getElementById('data_consent');
            const feeConsent = document.getElementById('fee_consent');
            const errorDiv = document.getElementById('consent-error');
            
            console.log('Data consent checked:', dataConsent ? dataConsent.checked : 'element not found');
            console.log('Fee consent checked:', feeConsent ? feeConsent.checked : 'element not found');
            
            if (!dataConsent.checked || !feeConsent.checked) {
                console.log('VALIDATION FAILED - MISSING CONSENT');
                errorDiv.style.display = 'block';
                errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }
            
            errorDiv.style.display = 'none';
            console.log('CONSENT VALIDATION PASSED');
            
            // Collect all data - using German localStorage keys
            const personalData = JSON.parse(localStorage.getItem('personalData') || '{}');
            const familyData = JSON.parse(localStorage.getItem('familyData') || '{}');
            const finalData = JSON.parse(localStorage.getItem('finalData') || '{}');
            const utmParams = JSON.parse(localStorage.getItem('utmParams') || '{}');
            
            console.log('COLLECTED DATA');
            console.log('Personal Data:', personalData);
            console.log('Family Data:', familyData);
            console.log('Final Data:', finalData);
            console.log('UTM Params:', utmParams);
            
            const completeApplication = {
                ...personalData,
                ...familyData,
                ...finalData,
                ...utmParams,
                submission_timestamp: Date.now(),
                language: 'russian',
                summary_confirmed: true,
                data_consent: true,
                fee_consent: true,
                processing_fee: '24.99 EUR'
            };
            
            localStorage.setItem('completeApplication', JSON.stringify(completeApplication));
            console.log('COMPLETE APPLICATION DATA', completeApplication);
            
            console.log('STARTING SUPABASE SEND');
            
            // Send to Supabase (wait for it to complete)
            sendToSupabase(completeApplication).then((success) => {
                console.log('SUPABASE SEND COMPLETED', success ? 'SUCCESS' : 'FAILED');
                
                // Always redirect to Stripe after attempting to send
                console.log('REDIRECTING TO STRIPE');
                window.location.href = 'https://buy.stripe.com/6oU9ASdmKaWT5ek1FJ1VK07';
            }).catch((error) => {
                console.error('SUPABASE SEND ERROR', error);
                
                // Still redirect to Stripe even on error
                console.log('REDIRECTING TO STRIPE AFTER ERROR');
                window.location.href = 'https://buy.stripe.com/6oU9ASdmKaWT5ek1FJ1VK07';
            });
        }

        async function sendToSupabase(data) {
            console.log('SENDE DATEN AN SUPABASE', data);
            
            try {
                // Direkt an Supabase senden
                const supabaseUrl = 'https://xomsibpyksrzrnixbdwf.supabase.co';
                const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhvbXNpYnB5a3NyenJuaXhiZHdmIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NjY2MzEyMiwiZXhwIjoyMDcyMjM5MTIyfQ.35zRO5wy3_fSGPGpuBm-aqskHOGqxODLtxEQzRFxXAc';

                console.log('Supabase URL:', supabaseUrl);

                // Sammle UTM-Parameter
                const urlParams = new URLSearchParams(window.location.search);
                const utmParams = {
                    utm_source: urlParams.get('utm_source') || '',
                    utm_medium: urlParams.get('utm_medium') || '',
                    utm_campaign: urlParams.get('utm_campaign') || '',
                    utm_term: urlParams.get('utm_term') || '',
                    utm_content: urlParams.get('utm_content') || ''
                };

                const dataToSend = {
                    user_id: `user_${Date.now()}`,
                    email: data.email || '',
                    source: 'russian_formal_comprehensive_summary',
                    language: 'russian',
                    checkout_clicked: true,
                    payment_completed: false,
                    price: 24.99,
                    currency: 'EUR',
                    price_uah: 1050,
                    vorname: data.vorname || '',
                    nachname: data.nachname || '',
                    herkunftsland: '',
                    deutschkenntnisse: data.deutschkenntnisse || '',
                    arbeitsbereich: data.beruf_ukraine || '',
                    json_answers: {
                        personal_info: {
                            vorname: data.vorname,
                            nachname: data.nachname,
                            email: data.email,
                            telefon: data.telefon,
                            geburtsdatum: data.geburtsdatum,
                            geburtsort: data.geburtsort,
                            staatsangehoerigkeit: data.staatsangehoerigkeit,
                            geschlecht: data.geschlecht,
                            familienstand: data.familienstand
                        },
                        passport_data: {
                            passnummer: data.passnummer,
                            ausstellungsort: data.ausstellungsort,
                            ausstellungsdatum: data.ausstellungsdatum,
                            gueltig_bis: data.gueltig_bis
                        },
                        family_entry: {
                            ehepartner_vorhanden: data.ehepartner_vorhanden,
                            ehepartner_name: data.ehepartner_name,
                            kinder_vorhanden: data.kinder_vorhanden,
                            kinder_namen_alter: data.kinder_namen_alter,
                            einreisedatum: data.einreisedatum,
                            einreiseweg: data.einreiseweg,
                            reiseart: data.reiseart,
                            familie_allein: data.familie_allein,
                            unterkunft_vorhanden: data.unterkunft_vorhanden,
                            wunsch_stadt: data.wunsch_stadt,
                            adresse: data.adresse,
                            verwandte_freunde: data.verwandte_freunde
                        },
                        work_goals: {
                            deutschkenntnisse: data.deutschkenntnisse,
                            beruf_ukraine: data.beruf_ukraine,
                            arbeiten_deutschland: data.arbeiten_deutschland,
                            einkommen_aktuell: data.einkommen_aktuell,
                            ersparnisse: data.ersparnisse,
                            finanzielle_unterstuetzung: data.finanzielle_unterstuetzung,
                            grund_deutschland: data.grund_deutschland,
                            dauerhaft_bleiben: data.dauerhaft_bleiben,
                            kriegsnachweis: data.kriegsnachweis
                        },
                        signature_consent: {
                            vollstaendiger_name: data.vollstaendiger_name,
                            datum_heute: data.datum_heute,
                            data_consent: data.data_consent,
                            fee_consent: data.fee_consent
                        },
                        utm_data: {
                            utm_source: utmParams.utm_source,
                            utm_medium: utmParams.utm_medium,
                            utm_campaign: utmParams.utm_campaign,
                            utm_term: utmParams.utm_term,
                            utm_content: utmParams.utm_content
                        },
                        metadata: {
                            submission_timestamp: new Date().toISOString(),
                            processing_fee: data.processing_fee,
                            page_source: 'russian_summary_page',
                            interface_language: 'russian'
                        }
                    }
                };
                
                console.log('PAYLOAD F√úR SUPABASE', dataToSend);
                
                // Direkt an Supabase arbeitserlaubnis_leads Tabelle
                const response = await fetch(`${supabaseUrl}/rest/v1/arbeitserlaubnis_leads`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': supabaseKey,
                        'Authorization': `Bearer ${supabaseKey}`,
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify(dataToSend),
                    keepalive: true
                });
                
                console.log('Response Status:', response.status);
                
                if (response.ok) {
                    console.log('Data sent to arbeitserlaubnis_leads SUCCESS');
                    console.log('DATEN ERFOLGREICH AN SUPABASE GESENDET');
                    return true;
                } else {
                    const errorText = await response.text();
                    console.error('Error sending to arbeitserlaubnis_leads:', response.status);
                    console.error('Error details:', errorText);
                    throw new Error(`HTTP error! status: ${response.status}, details: ${errorText}`);
                }
                
            } catch (error) {
                console.error('FEHLER BEIM SENDEN AN SUPABASE');
                console.error('Error Type:', error.name);
                console.error('Error Message:', error.message);
                console.error('Full Error:', error);
                return false;
            }
        }
    </script>
</body>
</html>